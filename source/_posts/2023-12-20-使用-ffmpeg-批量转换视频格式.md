---
title: 使用 ffmpeg 批量转换视频格式
date: 2020-11-07 14:34:43
tags:
categories: 工具
---
国庆买了一个线上的瑜伽课，然而天气一冷我就不想运动了，为了不浪费学费，在课程结束之前，计划把学习视频爬下来（小声叨叨：这种行为是可耻的，不可取，大家不要学我）。  

抓下视频文件的时候，发现一个视频居然是好多好多的切片 ts 视频。似乎没那么容易就拿到 mp4 文件。  

这些 ts 文件是从哪儿来的呢？找到一个 m3u8 链接，ok，来吧，转一下这个格式。
<!--more-->
### 一、m3u8 提取 ts 文件
在线工具：[m3u8 downloader](http://blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html)，这个可以直接转 mp4，不过我的视频转下来无法播放，遂放弃，只用来导出了 ts 文件。
### 二、安装 FFmpeg
{% tabs Fourth unique name %}
<!-- tab 了解入门 -->
[FFmpeg 视频处理入门教程 - 阮一峰的网络日志](https://www.ruanyifeng.com/blog/2020/01/ffmpeg.html)
<!-- endtab -->

<!-- tab 下载地址 -->
官网下载：[Download FFmpeg](https://www.ffmpeg.org/download.html)
<!-- endtab -->

<!-- tab macOS -->
<img src="https://i.loli.net/2020/11/24/OD9gtZdYVxXra3R.png">
<!-- endtab -->
{% endtabs %}

#### 配置环境变量
{% codeblock lang:bash ~/.bash_profile %}
#ffmpeg
export ffmpeg_HOME=/Users/myuser/Documents/ffmpeg
export PATH=$PATH:$ffmpeg_HOME

#配置完成后，执行 source 立即生效
source ~/.bash_profile

#检查是否生效
ffmpeg -version
{% endcodeblock %}


### 三、批量执行
```bash
# ts 转 mp4
# input.ts 为TS文件名，output.mp4 为输出的MP4文件名
ffmpeg -i input.ts -c copy -map 0:v -map 0:a -bsf:a aac_adtstoasc output.mp4

# 其他简略写法
# 如果音轨不是AAC_ADTS可以不加 -bsf:a aac_adtstoasc
ffmpeg -i input.ts -c:v:0 copy -c:a:0 copy -bsf:a aac_adtstoasc output.mp4
ffmpeg -i input.ts -c copy -map 0 -bsf:a aac_adtstoasc output.mp4
```

批量执行列表的 ts 文件：
```bash
#!/bin/bash
cd /Users/Downloads/ts
for file_name in `ls`
do
 text=`basename $file_name .ts`
 ffmpeg -i $text.ts -c copy -map 0 -bsf:a aac_adtstoasc $text.mp4
done
```

---
> [ffmpeg 常用命令总结](https://blog.csdn.net/weixin_42081389/article/details/100543007)  
[ls 去掉文件类型: basename](https://man.linuxde.net/basename)